<div class="mat-elevation-z2">
    <table
        mat-table
        [dataSource]="datasource"
        class="mat-table"
        matSort
        *ngIf="datasource.length > 0"
    >
        <!-- Nº -->
        <ng-container matColumnDef="no">
            <th mat-header-cell *matHeaderCellDef>Nº</th>
            <td mat-cell *matCellDef="let element; let i = index">
                {{ (currentPage - 1) * pageSize + i + 1 }}
            </td>
        </ng-container>

        <!-- Imagen -->
        <ng-container matColumnDef="imagen">
            <th mat-header-cell *matHeaderCellDef>Imagen</th>
            <td mat-cell *matCellDef="let element">
                <img
                    class="imagen-reporte"
                    *ngIf="element.imagen"
                    [src]="getImagenUrl(element.imagen)"
                    alt="Reporte"
                    width="60"
                    height="60"
                />
                <span *ngIf="!element.imagen">—</span>
            </td>
        </ng-container>

        <!-- Descripción -->
        <!-- <ng-container matColumnDef="descripcion">
            <th mat-header-cell *matHeaderCellDef>Descripción</th>
            <td mat-cell *matCellDef="let element">
                {{ element.descripcion || '—' }}
            </td>
        </ng-container> -->

        <!-- Categoría -->
        <ng-container matColumnDef="categoria">
            <th mat-header-cell *matHeaderCellDef>Categoría</th>
            <td mat-cell *matCellDef="let element">{{ element.categoria }}</td>
        </ng-container>

        <!-- Dirección -->
        <ng-container matColumnDef="direccion">
            <th mat-header-cell *matHeaderCellDef>Dirección</th>
            <td mat-cell *matCellDef="let element">{{ element.direccion }}</td>
        </ng-container>

        <!-- Cliente -->
        <ng-container matColumnDef="cliente">
            <th mat-header-cell *matHeaderCellDef>Cliente</th>
            <td mat-cell *matCellDef="let element">
                {{ element.cliente_nombre }}
                {{ element.cliente_apellido || '' }}
            </td>
        </ng-container>

        <!-- Latitud -->
        <ng-container matColumnDef="latitud">
            <th mat-header-cell *matHeaderCellDef>Latitud</th>
            <td mat-cell *matCellDef="let element">{{ element.latitud }}</td>
        </ng-container>

        <!-- Longitud -->
        <ng-container matColumnDef="longitud">
            <th mat-header-cell *matHeaderCellDef>Longitud</th>
            <td mat-cell *matCellDef="let element">{{ element.longitud }}</td>
        </ng-container>

        <!-- Teléfono -->
        <ng-container matColumnDef="telefono">
            <th mat-header-cell *matHeaderCellDef>Teléfono</th>
            <td mat-cell *matCellDef="let element">—</td>
        </ng-container>

        <!-- Usuario Crea -->
        <ng-container matColumnDef="usuario_crea">
            <th mat-header-cell *matHeaderCellDef>Usuario Crea</th>
            <td mat-cell *matCellDef="let element">
                {{ element.usuario_crea || '—' }}
            </td>
        </ng-container>

        <!-- Usuario Modifica -->
        <ng-container matColumnDef="usuario_modifica">
            <th mat-header-cell *matHeaderCellDef>Usuario Modifica</th>
            <td mat-cell *matCellDef="let element">
                {{ element.usuario_modifica || '—' }}
            </td>
        </ng-container>

        <!-- Created At -->
        <ng-container matColumnDef="created_at">
            <th mat-header-cell *matHeaderCellDef>Fecha Creación</th>
            <td mat-cell *matCellDef="let element">
                {{ element?.created_date }}
            </td>
        </ng-container>

        <!-- Updated At -->
        <ng-container matColumnDef="updated_at">
            <th mat-header-cell *matHeaderCellDef>Fecha Modificación</th>
            <td mat-cell *matCellDef="let element">
                {{ element?.updated_date ? element?.updated_date : '—' }}
            </td>
        </ng-container>

        <!-- Estado -->
        <ng-container matColumnDef="estado">
            <th mat-header-cell *matHeaderCellDef>Estado</th>
            <td mat-cell *matCellDef="let element">
                <span [appEstado]="element.estado"></span>
            </td>
            <!-- <td mat-cell *matCellDef="let element">{{ element.estado }}</td> -->
        </ng-container>

        <!-- Acciones -->
        <ng-container matColumnDef="acciones">
            <th mat-header-cell *matHeaderCellDef>Acciones</th>
            <td mat-cell *matCellDef="let element">
                <button
                    *ngIf="element.estado === '1'"
                    mat-icon-button
                    style="color: #ef4444"
                    color="warn"
                    (click)="onDelete(element.id)"
                >
                    <mat-icon>delete</mat-icon>
                </button>
            </td>
        </ng-container>

        <!-- Header and Row -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <!-- Paginador -->
    <mat-paginator
        [length]="totalItems"
        [pageSize]="pageSize"
        [pageSizeOptions]="[5, 10, 20]"
        (page)="getReportes($event.pageIndex + 1)"
        showFirstLastButtons
    >
    </mat-paginator>
</div>
